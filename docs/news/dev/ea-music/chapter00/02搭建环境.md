---
title: "第二节 搭建环境"
date: 2020-10-30 22:58:34
sidebar: "auto"
categories:
  - "Angular"
  - "Electron"
tags:
  - "electron"
  - "angular"
  - "npm"
  - "ng-zorro"
---


## electron介绍
Electron是一个实时框架，允许您使用HTML5，CSS和JavaScript创建桌面应用程序。Electron可以让你使用纯JavaScript调用丰富的原生(操作系统)APIs来创建桌面应用。Electron使用Web页面作为它的GUI，所以你能把它看作为一个被JavaScript控制的，精简版的Chromium浏览器。  
可以理解为electron是一个桌面应用的壳，装的内容使web页面。构建页面的各种框架，如Angular，Vue等，都可以与electron配合使用。  
## Angular介绍
Angular是一款开源JavaScript库，由Google维护，用来协助单一页面应用程序运行。Angular2.x与Angular1.x的区别类似Java 和 JavaScript 或者说是雷锋与雷峰塔的区别，所以在学习Angular2.x时大家需要做好重新学习一门语言的心里准备。Angular2以后的版本与Angular2基本类似。


## 构建一个Electron+Angular的桌面应用
### 1. 构建一个angular应用
```shell
ng new ea-music
```
### 2. 启动应用
```shell
cd ea-music
cnpm install --save-dev electron
cnpm i
ng serve
```
cnpm install electron --save-dev 安装electron包，--save-dev表示将electron依赖加入package.json文件。  
可以看到，命令启动了一个web服务，地址为：http://localhost:4200。

### 3. 修改package.json文件
+ script.start 修改启动脚本。需要同时启支electron和angular应用。
```json
"start": "npm-run-all -p electron:serve ng:serve"
```
+ 新增三个启动脚本
```json
"ng:serve": "ng serve"
"electron:serve-tsc": "tsc -p tsconfig-serve.json"
"electron:serve": "wait-on http-get://localhost:4200/ && npm run electron:serve-tsc && electron . --serve"
```
+ 新增script.main入口文件地址
```json
"main": "main.js"
```
+ 新增2个第三方包
> "npm-run-all": "4.1.5"
> "wait-on": "4.0.0"
```shell
cnpm install --save-dev npm-run-all@4.1.5 wait-on@4.0.0
```
```json
{
  "name": "ea-demo",
  "version": "0.0.0",
  "scripts": {
    "ng": "ng",
    "start": "npm-run-all -p electron:serve ng:serve",
    "build": "ng build",
    "test": "ng test",
    "lint": "ng lint",
    "e2e": "ng e2e",
    "ng:serve": "ng serve",
    "electron:serve-tsc": "tsc -p tsconfig-serve.json",
    "electron:serve": "wait-on http-get://localhost:4200/ && npm run electron:serve-tsc && electron . --serve"
  },
  "main": "main.js",
  "private": true,
  "dependencies": {
    "@angular/animations": "~10.2.0",
    "@angular/common": "~10.2.0",
    "@angular/compiler": "~10.2.0",
    "@angular/core": "~10.2.0",
    "@angular/forms": "~10.2.0",
    "@angular/platform-browser": "~10.2.0",
    "@angular/platform-browser-dynamic": "~10.2.0",
    "@angular/router": "~10.2.0",
    "rxjs": "~6.6.0",
    "tslib": "^2.0.0",
    "zone.js": "~0.10.2"
  },
  "devDependencies": {
    "@angular-devkit/build-angular": "~0.1002.0",
    "@angular/cli": "~10.2.0",
    "@angular/compiler-cli": "~10.2.0",
    "@types/jasmine": "~3.5.0",
    "@types/jasminewd2": "~2.0.3",
    "@types/node": "^12.11.1",
    "codelyzer": "^6.0.0",
    "electron": "^10.1.5",
    "jasmine-core": "~3.6.0",
    "jasmine-spec-reporter": "~5.0.0",
    "karma": "~5.0.0",
    "karma-chrome-launcher": "~3.1.0",
    "karma-coverage-istanbul-reporter": "~3.0.2",
    "karma-jasmine": "~4.0.0",
    "karma-jasmine-html-reporter": "^1.5.0",
    "protractor": "~7.0.0",
    "ts-node": "~8.3.0",
    "tslint": "~6.1.0",
    "typescript": "~4.0.2",
    "npm-run-all": "4.1.5",
    "wait-on": "4.0.0"
  }
}
```
4. 新增main.ts文件
在文件夹ea-music下新建main.ts文件
```typescript
const {
  app,  // 控制应用生命周期的模块
  BrowserWindow   // 创建原生浏览器窗口的模块
} = require('electron');

import * as path from 'path';
import * as url from 'url';

// 保持一个对于Window对象的全局引用，不然，当JavaScript被GC，window也会被自动关闭
let win;
const createWindow = () => {
  // 创建window窗口
  win = new BrowserWindow({
    width: 1200,
    height: 800,
    webPreferences: {
      plugins: true
    }
  });

  win.loadURL('http://localhost:4200');
  // 打开开发工具
  win.webContents.openDevTools();
  // 当window被关闭，这个事件会被关闭
  win.on('closed', () => win = null);
  win.on('ready-to-show', () => {

  });
};

// 当 Electron 完成了初始化并且准备创建浏览器窗口的时候这个方法就被调用
app.on('ready', createWindow);

// 当所有窗口被关闭时，退出程序
app.on('window-all-closed', () => {
  // 在 OS X 上，通常用户在明确地按下 Cmd + Q 之前应用会保持活动状态
  // tslint:disable-next-line: no-unused-expression
  process.platform !== 'darwin' && app.quit();
});

app.on('activate', () => {
  // On OS X it's common to re-create a window in the app when the
  // dock icon is clicked and there are no other windows open.
  // tslint:disable-next-line: no-unused-expression
  win === null && createWindow();
});


```

### 5. 新增tsconfig-serve.json文件
```json
{
  "compilerOptions": {
    "sourceMap": true,
    "declaration": false,
    "moduleResolution": "node",
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "target": "es5",
    "types": [
      "node"
    ],
    "lib": [
      "es2017",
      "es2016",
      "es2015",
      "dom"
    ]
  },
  "include": [
    "main.ts"
  ],
  "exclude": [
    "node_modules",
    "**/*.spec.ts"
  ]
}
```

### 6. 运行electron应用
```shell
cnpm i
npm start
``` 

cnpm 安装新增的应用包，使用npm start来启动electron应用。记得在起electron应用前，保证4200端口未被占用。